<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>Listing Details</title>
</head>
<body>
    <a href="index.html">Back to listings</a>
    <h1>Listing Details</h1>
    <h2 id="addr"><%= property[4] %></h2>
    <h2><%= property[5] %>, <%= property[6] %></h2>
    <h2 id="pCode"><%= property[8] %></h2>
    <h2 id="price">Price: $<%= property[3] %></h2>
    <p>Status: <%= property[1] %></p>
    <p>Property Type:</p>
    <p id="type"><%= property[7] %></p>
    <p>Condition: <%= property[9] %></p>
    <p>Baths: <%= property[10] %></p>
    <p>Beds: <%= property[11] %></p>
    <p>Year Built: <%= property[12] %></p>
    <p>Interior Space: <%= property[13] %> sqft</p>
    <p id="yard">Yard Space:</p>
    <p><%= property[20] %></p>
    <p id="garage">Garage: </p>
    <p><%= property[21] %></p>
    <p id="floors">Floors:</p>
    <p><%= property[22] %></p>
    <p id="basement">Basement:</p>
    <p><%= property[23] %></p>
    <h3>REALTOR</h3>
    <p><%= property[15] %></p>
    <p><%= property[19] %></p>
    <p>Proudly serving the community for <%= property[18] %> years!</p>
    <h4>CONTACT</h4>
    <p>Email: <%= property[16] %></p>
    <p>Phone: <%= property[17] %></p>

    <% if (user[3] === 'buyer') { %>
        <button onclick="window.location.href='CreateOffer.html'">Create Offer</button>
    <% } else if (user[3] === 'seller') { %>
        <button id="deleteButton"
                data-p-code="<%= property[8] %>"
                data-addr="<%= property[4] %>">Delete Listing</button>
        <button onclick="window.location.href='ViewOffers.html'">View Offers</button>
    <% } %>

</body>
</html>

<script>
    window.onload = function() {
        let type = document.getElementById('type').textContent;
        if (type === "Townhouse") {
            document.getElementById('yard').textContent = "Garage:";
            document.getElementById('garage').textContent = "Floors:";
            document.getElementById('floors').textContent = "Monthly HOA Fee:";
            document.getElementById('basement').textContent = "";
        } else if (type === "Condo") {
            document.getElementById('yard').textContent = "Monthly HOA Fee:";
            document.getElementById('garage').textContent = "Unit Number:";
            document.getElementById('floors').textContent = "";
            document.getElementById('basement').textContent = "";
        } else if (type === "Apartment") {
            document.getElementById('yard').textContent = "Unit Number:";
            document.getElementById('garage').textContent = "";
            document.getElementById('floors').textContent = "";
            document.getElementById('basement').textContent = "";
        }

    }

    document.getElementById('deleteButton').addEventListener("click", async function () {
        const userResp = confirm("Are you sure you want to delete this listing? This action is not reversible!");
        const deleteButton = document.getElementById('deleteButton');
        const postalCode = deleteButton.getAttribute('data-p-code');
        const address = deleteButton.getAttribute('data-addr');
        console.log(postalCode);
        console.log(address);
        if (userResp) { // if user pressed 'OK'
            const response = await fetch(`/delete-listing?address=${encodeURIComponent(address)}&postalCode=${encodeURIComponent(postalCode)}`, {
                method: "DELETE"
            });

            if (response.success) {
                alert("Successfully deleted listing with address: " + response.addr);
            } else {
                alert("ERROR, could not delete listing");
            }
        }
    });

</script>