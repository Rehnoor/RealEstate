<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Offer</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
<h1>Create Offer</h1>
<form id="offerForm">
    <label for="buyerEmail">Buyer Email:</label>
    <input type="email" id="buyerEmail" name="buyerEmail" required>

    <label for="listingID">Listing ID:</label>
    <input type="number" id="listingID" name="listingID" required>

    <label for="offerAmount">Offer Amount:</label>
    <input type="number" id="offerAmount" name="offerAmount" required>

    <label for="offerDate">Offer Date:</label>
    <input type="date" id="offerDate" name="offerDate" required readonly>

    <label for="offerExpiryDate">Offer Expiry Date:</label>
    <input type="date" id="offerExpiryDate" name="offerExpiryDate" required readonly>

    <button type="submit">Submit Offer</button>
</form>
<p>Back to <a href="index.html">Listing Details</a></p>

<script>
    document.getElementById('offerForm').addEventListener('submit', async function(event) {
        event.preventDefault();
        const buyerEmail = document.getElementById('buyerEmail').value;
        const listingID = document.getElementById('listingID').value;
        const offerAmount = document.getElementById('offerAmount').value;
        const offerDate = document.getElementById('offerDate').value;
        const offerExpiryDate = document.getElementById('offerExpiryDate').value;

        try {
            const response = await fetch('/create-offer', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ buyerEmail, listingID, offerAmount, offerDate, offerExpiryDate })
            });

            if (!response.ok) {
                throw new Error('Offer submission failed');
            }

            const result = await response.json();
            alert(result.message);
        } catch (error) {
            alert('Offer submission failed: ' + error.message);
        }
    });

    // Fetch offer details from the server
    async function fetchOfferDetails() {
        try {
            const response = await fetch('/offer-details');
            if (!response.ok) {
                throw new Error('Failed to fetch offer details');
            }
            const offerDetails = await response.json();
            document.getElementById('buyerEmail').value = offerDetails.buyerEmail;
            document.getElementById('listingID').value = offerDetails.listingID;
            document.getElementById('offerDate').value = offerDetails.offerDate;
            document.getElementById('offerExpiryDate').value = offerDetails.offerExpiryDate;
        } catch (error) {
            console.error('Error fetching offer details:', error);
        }
    }

    // Initialize form with fetched data
    fetchOfferDetails();
</script>
</body>
</html>